# Docker Compose vs Kubernetes å¯¹æ¯”è¯´æ˜

## ğŸ“Š å½“å‰éƒ¨ç½²æ¶æ„å¯¹æ¯”

### ğŸ³ Docker Compose ä¸­è¿è¡Œçš„æœåŠ¡

| æœåŠ¡          | é•œåƒ                            | ç«¯å£ | çŠ¶æ€     | è¯´æ˜                         |
| ------------- | ------------------------------- | ---- | -------- | ---------------------------- |
| **ZooKeeper** | confluentinc/cp-zookeeper:7.4.0 | 2181 | âœ… è¿è¡Œä¸­ | Kafka åè°ƒæœåŠ¡               |
| **Kafka**     | confluentinc/cp-kafka:7.4.0     | 9092 | âœ… è¿è¡Œä¸­ | æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡                 |
| **Kafka UI**  | provectuslabs/kafka-ui:latest   | 8080 | âœ… è¿è¡Œä¸­ | Kafka ç®¡ç†ç•Œé¢               |
| **Headlamp**  | ghcr.io/kinvolk/headlamp:latest | 4466 | âŒ åœç”¨   | K8s ç®¡ç†ç•Œé¢ï¼ˆå·²è¿ç§»åˆ° K8sï¼‰ |

### â˜¸ï¸ Kubernetes ä¸­è¿è¡Œçš„æœåŠ¡

| æœåŠ¡               | Namespace   | é•œåƒ                            | ç«¯å£  | çŠ¶æ€     | è¯´æ˜                  |
| ------------------ | ----------- | ------------------------------- | ----- | -------- | --------------------- |
| **Headlamp**       | infra       | ghcr.io/kinvolk/headlamp:latest | 30466 | âœ… è¿è¡Œä¸­ | K8s ç®¡ç†ç•Œé¢          |
| **headlamp-admin** | kube-system | -                               | -     | âœ… æ´»è·ƒ   | ç®¡ç†å‘˜ ServiceAccount |

---

## ğŸ”„ ä¸ºä»€ä¹ˆè¿™æ ·æ··åˆéƒ¨ç½²ï¼Ÿ

### Docker Compose é€‚åˆï¼š

**âœ… Kafka ç”Ÿæ€ç³»ç»Ÿ**
- **ç®€å•æ€§**: å•ä¸ª `docker-compose.yaml` æ–‡ä»¶ç®¡ç†æ•´ä¸ª Kafka æ ˆ
- **ç½‘ç»œ**: æœåŠ¡é—´é€šè¿‡å®¹å™¨åç›´æ¥é€šä¿¡ï¼ˆå¦‚ `kafka:9092`ï¼‰
- **ä¾èµ–ç®¡ç†**: `depends_on` ç¡®ä¿å¯åŠ¨é¡ºåº
- **å¼€å‘å‹å¥½**: å¿«é€Ÿå¯åŠ¨/åœæ­¢ï¼Œé€‚åˆå¼€å‘å’Œæµ‹è¯•

```yaml
# ä¾‹å¦‚ï¼šKafka ä¾èµ– ZooKeeper
kafka:
  depends_on:
    - zookeeper
  environment:
    KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
```

### Kubernetes é€‚åˆï¼š

**âœ… Headlamp (Kubernetes ç®¡ç†å·¥å…·)**
- **é›†ç¾¤å†…è®¤è¯**: ä½¿ç”¨ ServiceAccount è‡ªåŠ¨è®¤è¯
- **æƒé™ç®¡ç†**: RBAC ç²¾ç¡®æ§åˆ¶æƒé™
- **é«˜å¯ç”¨**: Pod è‡ªåŠ¨é‡å¯ï¼ŒæœåŠ¡å‘ç°
- **ä¼ä¸šçº§**: ç”Ÿäº§ç¯å¢ƒçš„æ ‡å‡†

```yaml
# ä¾‹å¦‚ï¼šServiceAccount è‡ªåŠ¨æƒé™
serviceAccountName: headlamp
args: ["-in-cluster"]  # é›†ç¾¤å†…è®¤è¯
```

---

## ğŸ¤” ä¸ºä»€ä¹ˆä¸å…¨éƒ¨ç”¨ Kubernetesï¼Ÿ

### Kafka åœ¨ K8s ä¸­çš„é—®é¢˜ï¼š
1. **é•œåƒå…¼å®¹æ€§**: `wurstmeister/kafka` åœ¨ ARM Mac ä¸Šæœ‰é—®é¢˜
2. **å¤æ‚æ€§**: éœ€è¦ StatefulSetã€PVCã€å¤šä¸ªé…ç½®æ–‡ä»¶
3. **å¼€å‘ä½“éªŒ**: Docker Compose æ›´ç®€å•ç›´æ¥

### Headlamp åœ¨ Docker ä¸­çš„é—®é¢˜ï¼š
1. **ç½‘ç»œéš”ç¦»**: å®¹å™¨æ— æ³•è®¿é—® K8s API Server (127.0.0.1:6443)
2. **è®¤è¯å¤æ‚**: éœ€è¦æŒ‚è½½ kubeconfigï¼Œæƒé™ç®¡ç†å¤æ‚
3. **åŠŸèƒ½é™åˆ¶**: åœ¨ K8s å†…è¿è¡ŒåŠŸèƒ½æ›´å®Œæ•´

---

## ğŸ“‹ å®é™…è¿è¡Œå¯¹æ¯”

### ğŸ³ Docker Compose ç½‘ç»œ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ZooKeeper   â”‚â—„â”€â”€â–ºâ”‚   Kafka     â”‚â—„â”€â”€â–ºâ”‚  Kafka UI   â”‚
â”‚   :2181     â”‚    â”‚   :9092     â”‚    â”‚   :8080     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â–²                   â–²                   â–²
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    kafka-network
```

### â˜¸ï¸ Kubernetes é›†ç¾¤
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Kubernetes Cluster            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Headlamp  â”‚â—„â”€â”€â–ºâ”‚ K8s API Server â”‚  â”‚
â”‚  â”‚  (Pod)      â”‚    â”‚   :6443        â”‚  â”‚
â”‚  â”‚  :30466     â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚         â–²                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚ ServiceAcc  â”‚                        â”‚
â”‚  â”‚ headlamp-   â”‚                        â”‚
â”‚  â”‚ admin       â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¡ æœ€ä½³å®è·µå»ºè®®

### å½“å‰æ¶æ„ä¼˜åŠ¿ï¼š
- **å¼€å‘æ•ˆç‡**: Kafka ç”¨ Docker Compose å¿«é€Ÿè¿­ä»£
- **ç”Ÿäº§å°±ç»ª**: Headlamp åœ¨ K8s ä¸­äº«å—ä¼ä¸šçº§ç‰¹æ€§
- **èŒè´£åˆ†ç¦»**: æ¶ˆæ¯é˜Ÿåˆ— vs é›†ç¾¤ç®¡ç†å·¥å…·åˆ†å¼€éƒ¨ç½²

### å¦‚æœè¦ç»Ÿä¸€åˆ° K8sï¼š
```bash
# å¯ä»¥ç”¨ Helm Chart éƒ¨ç½² Kafka
helm repo add bitnami https://charts.bitnami.com/bitnami
helm install kafka bitnami/kafka -n kafka-system --create-namespace
```

### å¦‚æœè¦ç»Ÿä¸€åˆ° Dockerï¼š
```bash
# éœ€è¦è§£å†³ç½‘ç»œé—®é¢˜
docker run --network host headlamp
# ä½†ä¼šå¤±å» K8s çš„ä¼ä¸šçº§ç‰¹æ€§
```

---

## ğŸ¯ æ€»ç»“

**å½“å‰æ··åˆæ¶æ„æ˜¯ç»è¿‡æƒè¡¡çš„æœ€ä½³é€‰æ‹©**ï¼š
- æ¯ä¸ªå·¥å…·éƒ½è¿è¡Œåœ¨æœ€é€‚åˆå®ƒçš„ç¯å¢ƒä¸­
- ä¿æŒäº†å¼€å‘çš„ç®€å•æ€§å’Œç”Ÿäº§çš„å¯é æ€§
- é¿å…äº†å„ç§å…¼å®¹æ€§å’Œå¤æ‚æ€§é—®é¢˜